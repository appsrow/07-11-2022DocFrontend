<div class="container">
<h1 class="section-head my-4">{{ 'userRewards.rewards' | translate }}</h1>
  <div class="row">
    <div class="col-12 col-sm-6 col-md-6 col-lg-3 col-xl-3 mb-4" *ngFor="let reward of giftCardInfo">
      <div class="background-primary text-center w-100 br-10 task_item">
        <div class="div-image-task">
          <img [src]="reward.gift_card_image ? reward.gift_card_image : '/assets/images/reward_default.png'" alt="Image of {{ reward.photo }}">
        </div>
        <h5>{{reward.card_name}}</h5>
        <h5>{{reward.card_details[0].price}} coins</h5>
        <button (click)="openModel(content,reward)" type="button" class="btn-outline  mb-4 mt-2">{{ 'userRewards.get' | translate }}</button>
      </div>
    </div>
  </div>
</div>
<ng-template #content let-modal>
  <div class="modal-header head_with_name">
    <h5 class="modal-title" id="modal-basic-title">{{modalContent.card_name}} {{ 'userRewards.giftCard' | translate }}</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body pt-0">
    <form [formGroup]="giftCardRewardForm">
      <div class="row">
        <div class="gift_card">
          <h5 class="heading-white">{{ 'userRewards.chooseValueGiftCard' | translate }}</h5>
          <ul>
            <li *ngFor="let giftCard of giftCards">
              <a href="javascript:void(0);" (click)="selectCard(giftCard)" class="gift_detail" [ngClass]="{'selected': cardInformation == giftCard && totalCoins > giftCard.price , 'unlock': totalCoins > giftCard.price , 'outof_stock': outOfStock === true }">
                <h4>{{giftCard.amount}} â‚¬</h4>
                <span>
                  <div>
                    <svg id="lock" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon line" width="48" height="48"><path id="primary" d="M13.5,14.5A1.5,1.5,0,1,1,12,13,1.5,1.5,0,0,1,13.5,14.5ZM12,17V16m7,4V10a1,1,0,0,0-1-1H6a1,1,0,0,0-1,1V20a1,1,0,0,0,1,1H18A1,1,0,0,0,19,20ZM16,9V7a4,4,0,0,0-4-4h0A4,4,0,0,0,8,7V9" stroke="currentColor" style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.5;"></path></svg> 
                    {{giftCard.price}} Coins</div>
                  <small>Out of stock</small>
                </span>
              </a>
            </li>
          </ul>
        </div>
        <div class="col-md-12">
          <p class="mb-3 heading-white" *ngIf="cardInformation">{{ 'userRewards.enterEmailGiftCard' | translate }} </p>
          <div class="form-group m-0">
            <label class="lbl-popup-input mb-2" *ngIf="cardInformation">{{ 'userRewards.enterYourEmailAddress' | translate }} <span class="text-danger error-msg">*</span></label>
            <input type="text" *ngIf="cardInformation" formControlName="userEmail" class="form-control"
              placeholder="{{ 'userRewards.pleaseEnterYourEmailAddress' | translate }}">
            <div
              *ngIf="cardInformation && giftCardRewardForm.controls['userEmail'].errors && (giftCardRewardForm.controls['userEmail'].dirty || giftCardRewardForm.controls['userEmail'].touched) || submitted">
              <div *ngIf="giftCardRewardForm.controls['userEmail'].errors?.required" class="text-danger">{{ 'shared.emailRequired' | translate }}  </div>
              <div
                *ngIf="giftCardRewardForm.controls['userEmail'].value !== '' && giftCardRewardForm.controls['userEmail'].invalid"
                class="text-danger">{{ 'shared.emailWrongFormat' | translate }}</div>
            </div>
            <div class="details mt-4" *ngIf="cardInformation">
              <div class="details-left">
                <h5 class="heading-green">{{ 'userRewards.details' | translate }}</h5>
                <h5 class="line-main">{{cardInformation ? cardInformation.price : ''}} Coins  <hr class="line"/> </h5>
              </div>
              <div class="details-right">
                <h5 class="heading-green">{{ 'userRewards.total' | translate }}</h5>
                <h5>{{cardInformation ? cardInformation.amount : ''}}  {{ 'userRewards.giftCardWorth' | translate }}</h5>
              </div>
            </div>
            <div class="terms">
              <p class="mt-2 heading-white text">{{ 'userRewards.termsConfirm' | translate }} 
                <a (click)="goToPrivacy('terms')" target="_blank">{{ 'footer.terms' | translate }}</a> {{ 'userRewards.our' | translate }}
                <a (click)="goToPrivacy('privacy')"  target="_blank">{{ 'footer.privacy' | translate }} </a> {{ 'userRewards.and' | translate }} {{ 'userRewards.our' | translate }}
                <a (click)="goToPrivacy('returnPolicy')"  target="_blank">{{ 'footer.returnPolicy' | translate }}</a>
              </p>
            </div>
            <div class="d-flex justify-content-center">
              <button type="button" class="btn btn-green" [ngClass]="cardInformation ? '' : 'disabled'" (click)="openConfirmModel(confirm)">{{ 'shared.confirm' | translate }}</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</ng-template> 
<ng-template #confirm let-modal>
  <div class="modal-header head_with_name">
    <h5 class="modal-title" id="modal-basic-title">{{ 'userRewards.pleaseConfirmGiftCard' | translate }}</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body pt-0">
    <form [formGroup]="giftCardRewardForm">
      <div class="row">
        <div class="col-md-12">
          <div>
            <h6 class="my-4 heading-white ">{{ 'userRewards.pleaseConfirmEmailAddress' | translate }}</h6>
          </div>
          <div class="form-group m-0">
            <label class="heading-white mt-3"><span class="bold">Email :</span> &nbsp;<span class="">{{userEmail}}</span></label>
            
          </div>
          <div class="details mt-4">
            <div class="details-left">
              <h5 class="heading-green">{{ 'userRewards.checkout' | translate }}</h5>
              <h5 class="line-main">{{cardInformation ? cardInformation.price : ''}} Coins <hr class="line"/> </h5>
            </div>
            <div class="details-right">
              <h5 class="heading-green">{{ 'userRewards.total' | translate }}</h5>
              <h5>{{cardInformation ? cardInformation.amount : ''}}  Gift card worth</h5>
            </div>
          </div>
          <h6 class="heading-white mt-4 mb-5">{{ 'userRewards.availableBalanceCondition' | translate }} <span>{{totalAvailableGiftCardCoins}}</span>&nbsp;{{ 'userRewards.coins' | translate }}</h6>
          <div class="terms">
          <p class="mt-4 heading-white text mb-0">
            {{ 'userRewards.giftCardsCondition1' | translate }} 
          </p>
          <p class="heading-white text">
            {{ 'userRewards.giftCardsCondition2' | translate }}
          <a (click)="goToPrivacy('legalNote')">{{ 'userRewards.legalNote' | translate }}</a>
          </p>
        </div>
          <div class="d-flex justify-content-center mt-4">
            <button type="button" class="btn btn-green me-3" 
              (click)="redeemGiftCard(cardInformation.id)">{{ 'shared.confirm' | translate }}</button>
            <button type="button" class="btn-outline" (click)="modal.close('Cross click')">{{ 'shared.cancel' | translate }}</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</ng-template> 